#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-push checks..."

# Run linting
echo "📝 Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
    echo "❌ ESLint failed! Please fix linting errors before pushing."
    exit 1
fi

# Run TypeScript type checking
echo "🔍 Running TypeScript type check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
    echo "❌ TypeScript type check failed! Please fix type errors before pushing."
    exit 1
fi

# Check if site is running and healthy
echo "🏥 Checking site health..."
curl -s -o /dev/null -w "%{http_code}" http://localhost:3001/api/health | grep -q "200"
if [ $? -ne 0 ]; then
    echo "⚠️  Warning: Site is not running or health check failed."
    echo "   Make sure to test your changes locally before pushing!"
fi

echo "✅ All pre-push checks passed!"