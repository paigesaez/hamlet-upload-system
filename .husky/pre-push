#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."

# Run linting
echo "ğŸ“ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
    echo "âŒ ESLint failed! Please fix linting errors before pushing."
    exit 1
fi

# Run TypeScript type checking
echo "ğŸ” Running TypeScript type check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript type check failed! Please fix type errors before pushing."
    exit 1
fi

# Check if site is running and healthy
echo "ğŸ¥ Checking site health..."
curl -s -o /dev/null -w "%{http_code}" http://localhost:3001/api/health | grep -q "200"
if [ $? -ne 0 ]; then
    echo "âš ï¸  Warning: Site is not running or health check failed."
    echo "   Make sure to test your changes locally before pushing!"
fi

echo "âœ… All pre-push checks passed!"